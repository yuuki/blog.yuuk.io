---
Title: 自然のごとく複雑化したウェブシステムの運用自律化に向けて - 第3回ウェブサイエンス研究会
Category:
- Monitoring
- Concept
- Experimentable
Date: 2017-11-26T23:30:00+09:00
URL: http://blog.yuuk.io/entry/2017/the-concept-of-autonomous-web-system
Draft: true
---

この記事は、[人工知能学会 合同研究会2017 第3回ウェブサイエンス研究会](http://sigwebsci.tumblr.com/post/166061452488/%E7%AC%AC3%E5%9B%9E%E3%82%A6%E3%82%A7%E3%83%96%E3%82%B5%E3%82%A4%E3%82%A8%E3%83%B3%E3%82%B9%E7%A0%94%E7%A9%B6%E4%BC%9A%E3%81%94%E6%A1%88%E5%86%85)の招待講演の内容を加筆修正したものです。

# 概要

# 1. ウェブシステムの信頼性を守る仕事

ここでのウェブシステムとは、ウェブサービスを構成する要素と要素のつながりを指しており、技術要素とは「ブラウザ」「インターネットバックボーン」「ウェブサーバ」「データベース」「データセンター内ネットワーク」などのことを指します。
特に、データセンター内のサーバ・ネットワークおよびその上で動作するウェブアプリケーションを指すことがほとんどです。
総体としてのウェブというよりは、単一組織内の技術階層としてのシステムに焦点をあてています。

ウェブシステムの最も基本的な機能として、「信頼性」があります。
信頼性を守る役割は「Site Reliability Engineer(SRE)」が担います。
SREはウェブ技術者界隈で市民権を得ている概念であり、Googleのエンジニアたちによって書かれた書籍「Site Reliability Engineering」[Bet17]に詳細が記されています。

信頼性にはいくらかの定義のしようがあります。
[Bet17]では[Oco12]の定義である「システムが求められる機能を、定められた条件の下で、定められた期間にわたり、障害を起こすことなく実行する確率」を採用しています。
信頼性というとつい100%を目指したくなりますが、信頼性と費用はトレードオフなため、信頼性を最大化するということはあえてしません。

さらに、信頼性をたんに担保することが仕事なのではなく、費用を最小化することが求められます。
この記事では、`費用=コンピューティングリソース費用 + 人件費用 + 機会費用` ((発表時には機会費用を含めていませんでしたが、機会費用を大幅に増加させて前者2つを削減できるため、この記事では含めました))としています。
SREは費用をエンジニアリングにより削減できます。例えば、前者は、ソフトウェアの実行効率化などにより達成され、後者はソフトウェア自動化などにより達成されます。
以上より、SREの仕事のメンタルモデルは、「目標設定された信頼性((厳密にはService Level Objective(SLO)))を制約条件として、費用を最小にする最適化問題」((信頼性と費用はトレードオフであり、信頼性を定期的に見直す必要があります。高すぎる信頼性のために想定より費用が最小化できないとなれば、例えば四半期ごとに信頼性目標を下げるといった運用が必要です)) (([Bet17]では、「サービスのSLOを下回ることなく、変更の速度の最大化を追求する」という表現になっています。今回は、自分自身のメンタルモデルに近い、費用の最小化という表現を選択しました。))を解くことであると言い換えられると考えます。
特にSREでは、定型作業(トイルと呼ばれる)を自動化し、スケールさせづらい人間ではなくコンピュータをスケールさせることが重要な仕事となります。

一般の人々からみれば、ウェブシステムは、十分自律動作していると言えます。
内部的に障害が発生したとしても、人々は何もせずとも、障害から回復し普段通りサービスを利用できます。
ただし、その裏では、信頼性を担保するために、数多くの人間の手作業や判断が要求されているのが現実です。
人間がなにもしなければ、およそ1週間程度((これはサービスによって大きく異なる。これまで運用してきたサービスの肌感覚では、1週間程度。運が良くて1ヶ月程度。))で信頼性は損なわれることもあります。

我々のゴールは、最終的にコンピュータのみでシステムを運用可能な状態にすることです。
IOTS2016の開催趣旨が、このゴールを端的に言い表しています。

>
インターネット上では多種多様なサービスが提供されている。このサービスを提供し続け、ユーザに届けることを運用と呼ぶ。サービスが複雑・多様化すれば運用コストは肥大する。このコストを運用担当者の人的犠牲により「なんとか」してしまうことが「運用でカバーする」と揶揄される。日本では大規模構造物を建造する際に、破壊されないことを祈願して人身御供 (人柱) を捧げる伝統があるが、現在のインターネットの一部はこのような運用担当者の人柱の上に成立する前時代的で野蛮な構造物と言うことができる。
>
運用担当者を人柱となることから救う方法の一つが運用自動化である。運用の制御構造における閾値を明らかにすることにより、人は機械にその仕事を委託することができる。機械学習や深層学習により、この閾値を明らかにすることをも機械に委託することが可能となることも期待される。不快な卑しい仕事をやる必要がなくなるのは、人間にとってひじょうな福祉かもしれないが、あるいはそうでないかもしれない。しかし機械に仕事を委託することにより空いた時間を人間が他のことに使うことができるのは事実である。
>
本シンポジウムは、インターネットやネットワークのサービスの運用の定量的な評価を通じて、積極的に制御構造を計算機に委託することで人間の生産性を向上させ社会全体の収穫加速に結びつけることを目的とする。
>
IOTS2016 開催の趣旨より引用 http://www.iot.ipsj.or.jp/iots/2016/announcement

# 2. ウェブシステム運用の現状と課題

# 3. ウェブシステムの自律運用へのアプローチ

# 4. 自律運用の壁とウェブサイエンス

# 5. 議論

解析しようと思ったこと
- ウェブシステムの階層構造の変化
- ウェブシステムの階層ごとの到着分布
- ウェブシステムの自律度合い。最初は人がオペレーションせずにいられた期間の長さでみる。
- SREの組織コミュニケーションのコスト変化
- 重要なのははてなでは、観測器であるMackerelがあること

# 6. まとめ

# 参考文献

- [Bet17]: Betsy Beyer, Chris Jones, Jennifer Petoff, Niall Richard Murphy編 澤田武男 関根達夫 細川一茂 矢吹大輔 監訳Sky株式会社 玉川竜司訳,「SRE サイトリライアビリティエンジニアリング ――Googleの信頼性を支えるエンジニアリングチーム」,オライリー・ジャパン,2017/08, https://www.oreilly.co.jp/books/9784873117911/
- [Oco12] P. O'Connor and A. Kleyner, Practical Reliability Engineering, 5th edition: Wiley, 2012.

# 発表スライド

[https://speakerdeck.com/yuukit/experimentable-infrastructure:embed]

# あとがき

そもそも、ウェブサイエンス研究会に招待していただいたきっかけは、IPSJ-ONE 2017 [http://blog.yuuk.io/entry/ipsjone2017:title:bookmark] の登壇にてご一緒した鳴海先生に声をかけていただいたことです。
さすがに、場違いではとも思いました。というのも、僕が実際やっていることは、[時系列データベースの開発](http://blog.yuuk.io/entry/the-rebuild-of-tsdb-on-cloud)であったり、10年前から続くウェブシステムの運用効率化などであり、技芸であって科学ではない((John Allspaw、Jesse Robbins編、角 征典訳,ウェブオペレーションーーサイト運用管理の実践テクニック,オライリージャパン より引用))からです。
しかし、[はてなシステムを構想する](https://speakerdeck.com/yuukit/the-concept-of-hatena-system)にあたって、地に足がついてなくてもいいから、無理やり未来を考えるいい機会になると捉え、登壇を引き受けさせていただきました。
今回の研究会のテーマは、「自然現象としてのウェブ」ということで、本当に何を話したらよいかわからないテーマで相当苦戦しましたが、その結果、IPSJ-ONE登壇で考えたことの言語化を進められました。((発表自体は、タイムコントロールに久々に大失敗して、途中スライドスキップして残念な感じになってしまいましたが、この記事で補完できればと思います。))

普段はどうしても目の前の課題に熱中しがちで、未来のことを考えようとはなかなか思いません。
概念や思想だけではなかなかそれを取り入れようとは考えず、それを実現するソフトウェアなりハードウェアが目の前にあらわれ使える状態になってはじめて目を向けることになります。
例えば、AWSもDockerもないと仮定して、Immutable Infrastructureの考え方に触れたとしても、到達までの道筋がすぐにはみえないため、諦めて考えないようにしてしまいそうです。

発表後に、研究会の幹事である橋本先生に、技術者はどこまで先を考えているものなのか、と質問をいただきました。
少なくとも、日本のウェブの技術者界隈で、未来の技術ビジョンを設定し、それに進もうとしている様子が外からみえることはなかなかありません。
[ペパボ研究所が掲げるなめらかなシステム](https://rand.pepabo.com/) ((研究所なので技術者界隈とは呼ばないかもしれません))が僕の知る唯一の例です。
Real Worldでは、一歩前に進むだけでも本当に様々な問題が起き、とにかく目の前のことを倒すことが求められるので、とても未来どころではなくなるというのが現状かもしれません。

未来を考えるのは、研究者の場合は当たり前に求められるという印象があります。
しかし、SREの分野では、研究者のコミュニティが他と比べて未発達なように思います。
近い分野である情報ネットワークに関しては、日本でも様々な研究会がありますが、僕の知る限りでは、日本では我々の分野に関する研究会は存在しないようです。((海外ではUSENIXのLISAやSREconなどがあります))

そこで、[ウェブシステムアーキテクチャ研究会](http://websystemarchitecture.hatenablog.jp/entry/2017/11/16/182041)、(https://twitter.com/search?f=tweets&vertical=default&q=%23wsa%E7%A0%94&src=typd)というものを立ち上げようとしています。
第1回は京都開催にもかかわらず、全員発表型で10人以上の参加者が既に集まっています。
今回の講演の準備をするにあたって、我々の分野で未来を議論するための既存の枠組みや土台があまりないことを改めて実感しました。((SRE本は本当に稀有な存在))
WSA研では、未来を考えるために、現状を体系化し、そこから新規性や有用性を追求していこうと思います。
