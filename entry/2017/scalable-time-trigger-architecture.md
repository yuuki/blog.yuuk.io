---
Title: cronlessアーキテクチャ構想: DBMSのTTL期限切れイベントを利用したスケーラブルなタイムトリガー
Category:
- Architecture
Draft: true
CustomPath: 2017/scalable-time-trigger-architecture
---

この記事は[第1回ウェブシステムアーキテクチャ(WSA)研究会](http://websystemarchitecture.hatenablog.jp/)の原稿です。

# 概要

Webサービスにおいて、ユーザーが発生させるイベントとは異なり、任意の時間周期で任意のバッチ処理を実行させたいことがある。
例えば、課金機能のための月次集計処理、機械学習のための学習モデルの定期更新などである。
一般的な手法では、特定サーバ上のcronなどのタイムスケジューラーにより、バッチ処理を実行させる。

しかし、このバッチ処理手法には、スケーラビリティと実行時のエラー回復に関する2つの問題がある。
まず一般に、データベース上の処理対象レコード数が増加するにつれ、バッチ処理の実行時間が増大するため、レコード数に対してスケールしない。
次に、実行途中にエラーが発生した場合、再試行したとしても結果が等しくなるように、バッチ処理プログラムを設計する必要がある。

これらの2つの問題に対して、DBMSのTTL期限切れイベントをトリガーとし、予め登録された任意の処理を実行するアーキテクチャを考えた。
このアーキテクチャにより、データレコードごとに処理を記述するため、バッチ処理と比較して、再試行時を考慮したコードを書きやすい。
さらに、レコード単位のトリガー処理の場合、他の処理プロセスとデータ競合しないため、レコード数に対して処理時間をスケールさせやすい。

# はじめに

<!-- - FaaSでいうところのイベントトリガー型スケジューラー -->

# タイムトリガーの既存手法と課題

<!-- - レコード数が増加するにつれ実行時間が増大する -->
<!-- - 処理分割が必要 -->

# 提案手法


# 実験と考察

<!-- - 複数のレコードをまとめる処理がしづらくなる -->
<!-- - バースト制御が難しくなる -->
<!--  -->
<!-- - TTLのexpire時刻と実際の削除時刻のディレイが大きいのはなぜか -->
<!-- - なぜRDBMSでは、TTLがないか -->

# まとめ

